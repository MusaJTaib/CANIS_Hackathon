<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Bubble Chart</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
      .circle {
        fill: #1f77b4;
        stroke: #fff;
        opacity: 0.8;
      }
  
      .circle:hover {
        fill: #ff7f0e;
        stroke: #fff;
      }
  
      .tooltip {
        position: absolute;
        opacity: 0;
        pointer-events: none;
        padding: 10px;
        background-color: #333;
        color: #fff;
        border-radius: 5px;
        font-family: Arial, sans-serif;
        font-size: 12px;
        line-height: 1.2em;
      }
  
      .tooltip:after {
        content: "";
        position: absolute;
        top: 50%;
        right: 100%;
        margin-top: -5px;
        border-width: 5px;
        border-style: solid;
        border-color: transparent #333 transparent transparent;
      }
  
      .label {
        font-family: Arial, sans-serif;
        font-size: 12px;
        text-anchor: middle;
        pointer-events: none;
        fill: #000;
      }
  
    </style>
</head>
<body>
    <script>
      
      d3.csv("TOP100_sorted_entities_Misinfo_FAKE.csv").then(function(data) {

        // Filter data by Entity = "PERSON"
        data = data.filter(function(d) {
            return d.Entity === "PERSON";
        });
        
        // Set up dimensions and margins for chart
        var width = window.innerWidth;
        var height = window.innerHeight;
        var margin = { top: 20, right: 20, bottom: 20, left: 20 };


        // Calculate minimum and maximum values for count
        var countMin = d3.min(data, function(d) { return +d.Count; });
        var countMax = d3.max(data, function(d) { return +d.Count; });

        // Set up scales for circle radius and color
        var radiusScale = d3.scaleLog()
            .domain([countMin, countMax])
            .range([30, 100]);
        var colorScale = d3.scaleOrdinal(d3.schemeCategory10);

        // Set up SVG element
        var svg = d3.select("body")
            .append("svg")
            .attr("width", width)
            .attr("height", height);

        // Add circles for each data point
        var circles = svg.selectAll("circle")
            .data(data)
            .enter()
            .append("circle")
            .attr("cx", function(d, i) { return i * 50 + 50; })
            .attr("cy", height / 2)
            .attr("r", function(d) { return radiusScale(+d.Count); })
            .style("fill", function(d) { return colorScale(d.Name); })
            .style("opacity", 0.7)
            .on("mouseover", function(d) {
                d3.select(this)
                    .style("opacity", 1)
                    .attr("stroke-width", 3)
                    .attr("stroke", "black");
            })
            .on("mouseout", function(d) {
                d3.select(this)
                    .style("opacity", 0.7)
                    .attr("stroke-width", 0);
            });

        // Add text labels for each data point
        var labels = svg.selectAll("text")
            .data(data)
            .enter()
            .append("text")
            .attr("x", function(d, i) { return i * 50 + 50; })
            .attr("y", height / 2)
            .attr("dy", ".35em")
            .text(function(d) { return d.Name + " (" + d.Count + ")"; })
            .style("text-anchor", "middle")
            .style("font-size", "12px")
            .style("fill", "black");
        var simulation = d3.forceSimulation(data)
            .force("center", d3.forceCenter(width / 2, height / 2))
            .force("charge", d3.forceManyBody().strength(10))
            .force("collision", d3.forceCollide().radius(function(d) {
                return radiusScale(+d.Count);
            }))
            .force("x", d3.forceX().strength(0.05))
            .force("y", d3.forceY().strength(0.05))
            .alpha(1)
            .alphaDecay(0.01)
            .on("tick", ticked);

        // Define tick function for force simulation
        function ticked() {
            circles.attr("cx", function(d) {
                    return d.x = Math.max(radiusScale(+d.Count), Math.min(width - radiusScale(+d.Count), d.x));
                })
                .attr("cy", function(d) {
                    return d.y = Math.max(radiusScale(+d.Count), Math.min(height - radiusScale(+d.Count), d.y));
                });

            labels.attr("x", function(d) {
                    return d.x = Math.max(radiusScale(+d.Count), Math.min(width - radiusScale(+d.Count), d.x));
                })
                .attr("y", function(d) {
                    return d.y = Math.max(radiusScale(+d.Count), Math.min(height - radiusScale(+d.Count), d.y));
                });
        }

        // Start the simulation
        simulation.restart();

      });
    </script>
</body>
</html>

<!-- <!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Interactive Bubble Chart</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        .chart circle {
            fill: #1f77b4;
            opacity: 0.8;
            stroke: #fff;
            stroke-width: 1.5px;
        }

        .chart circle:hover {
            fill: #ff7f0e;
        }

        .chart text {
            font-family: Arial, sans-serif;
            font-size: 12px;
            text-anchor: middle;
            fill: #000;
        }
    </style>
</head>
<body>
    <svg width="960" height="500"></svg>
    <script>
        // Set up chart dimensions
        const width = 960;
        const height = 500;
        const margin = {top: 20, right: 20, bottom: 30, left: 50};

        // Create chart
        const svg = d3.select('svg')
                      .attr('width', width)
                      .attr('height', height);
        
        const chart = svg.append('g')
                         .attr('class', 'chart')
                         .attr('transform', `translate(${margin.left},${margin.top})`);

        // Load data
        d3.csv('TOP100_sorted_entities_Misinfo_FAKE.csv', d => ({ entity: d.Entity, name: d.Name, count: +d.Count }))
          .then(data => {
              data = data.filter(function(d) {
                  return d.entity === "PERSON";
                });
              // Set up scales
              const rScale = d3.scaleLinear()
                               .domain([0, d3.max(data, d => d.count)])
                               .range([0, 50]);

              // Create bubbles
              const bubbles = chart.selectAll('.bubble')
                                   .data(data)
                                   .enter()
                                   .append('g')
                                   .attr('class', 'bubble')
                                   .attr('transform', d => `translate(${Math.random() * (width - margin.left - margin.right)},${Math.random() * (height - margin.top - margin.bottom)})`);

              bubbles.append('circle')
                     .attr('r', d => rScale(d.count))
                     .attr('fill', d => d3.interpolateBlues(d.count / d3.max(data, d => d.count)))
                     .on('mouseover', function () {
                         d3.select(this)
                           .transition()
                           .duration('100')
                           .attr('opacity', '.5');
                     })
                     .on('mouseout', function () {
                         d3.select(this)
                           .transition()
                           .duration('100')
                           .attr('opacity', '1');
                     });

              bubbles.append('text')
                     .text(d => `${d.name} (${d.count})`)
                     .attr('dy', '0.35em')
                     .attr('text-anchor', 'middle');
              }

          );
    </script>
</body>
</html> -->